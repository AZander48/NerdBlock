{% extends "layouts/default.njk" %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-gradient-to-b from-gray-900 to-gray-800 px-4">
  <div class="bg-gray-700 p-8 rounded-2xl shadow-xl w-full max-w-md">
    <h2 class="text-3xl font-bold text-center mb-6">Create Your Nerdblock Account</h2>
    
    <form action="/register" method="POST" class="space-y-6">
      <div>
        <label for="userName" class="block text-sm font-medium mb-1">User Name</label>
        <input type="text" id="userName" name="userName" required
               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" />
      </div>
      <div>
        <label for="firstName" class="block text-sm font-medium mb-1">First Name</label>
        <input type="text" id="firstName" name="firstName" required
               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" />
      </div>

      <div>
        <label for="lastName" class="block text-sm font-medium mb-1">Last Name</label>
        <input type="text" id="lastName" name="lastName" required
               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" />
      </div>

      <div>
        <label for="email" class="block text-sm font-medium mb-1">Email Address</label>
        <input type="email" id="email" name="email" required
               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" />
      </div>

      <div>
        <label for="password" class="block text-sm font-medium mb-1">Password</label>
        <input type="password" id="password" name="password" required
               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" />
      </div>

      <div>
        <label for="confirm" class="block text-sm font-medium mb-1">Confirm Password</label>
        <input type="password" id="confirm" name="confirm" required
               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" />
      </div>

      <div>
        <label for="phoneNumber" class="block text-sm font-medium mb-1">Phone Number</label>
        <input type="text" id="phoneNumber" name="phoneNumber"
               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" />
      </div>

      <div>
        <label for="shippingAddress" class="block text-sm font-medium mb-1">Shipping Address</label>
        <input type="text" id="shippingAddress" name="shippingAddress"
               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" />
      </div>

      <div>
        <label for="billingAddress" class="block text-sm font-medium mb-1">Billing Address</label>
        <input type="text" id="billingAddress" name="billingAddress"
               class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" />
      </div>

      <button type="submit" id="submitButton"
              class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
        Register
      </button>

      <p class="text-sm text-center text-gray-400 mt-4">
        Already have an account?
        <a href="/login" class="text-purple-400 hover:underline">Log in</a>
      </p>
    </form>
  </div>
</div>

<script type="module">
import { queryApi } from './api/queries.js';

// Function to handle form submission
async function handleFormSubmit(event) {
    event.preventDefault();
    const button = document.getElementById('submitButton');
    button.disabled = true;
    button.textContent = 'Registering...';
    
    const formData = new FormData(event.target);
    
    // Validate passwords match
    const password = formData.get('password');
    const confirm = formData.get('confirm');
    
    if (password !== confirm) {
        alert('Passwords do not match!');
        button.disabled = false;
        button.textContent = 'Register';
        return;
    }
    
    const subscriberData = {
        userName: formData.get('userName'),
        firstName: formData.get('firstName'),
        lastName: formData.get('lastName'),
        email: formData.get('email'),
        password: password,
        phoneNumber: formData.get('phoneNumber'),
        shippingAddress: formData.get('shippingAddress'),
        billingAddress: formData.get('billingAddress')
    };

    try {
        const response = await queryApi.registerSubscriber(subscriberData);
        console.log('Registration successful:', response);
        window.location.href = '/login';
    } catch (error) {
        console.error('Registration failed:', error);
        alert(error.message || 'Registration failed. Please try again.');
    } finally {
        button.disabled = false;
        button.textContent = 'Register';
    }
} 

// Add event listener when the DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('form');
    form.addEventListener('submit', handleFormSubmit);
});
</script>
{% endblock %}
